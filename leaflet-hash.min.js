(function(){var t,o=function(t,o){return function(){return t.apply(o,arguments)}};t=function(){function t(t){this.map=t;this.remove=o(this.remove,this);this.formatHash=o(this.formatHash,this);if(history.pushState){this.withPushState()}else{this.withoutPushState()}}t.prototype.withPushState=function(){var t,o=this;window.onpopstate=function(t){if(t.state){return o.map.setView(t.state.center,t.state.zoom)}};if(location.hash){t=this.parseHash(location.hash);this.map.setView(t.center,t.zoom)}else{history.replaceState.apply(history,this.formatHash())}return this.map.on("moveend",function(){var t;t=o.formatHash();if(location.hash!==t[2]){return history.pushState.apply(history,t)}})};t.prototype.withoutPushState=function(){var t,o,a=this;if(location.hash){o=this.parseHash(location.hash);this.map.setView(o.center,o.zoom)}else{location.hash=this.formatHash()[2]}this.map.on("moveend",function(){var t;t=a.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}});if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){return window.onhashchange=function(){if(location.hash){o=a.parseHash(location.hash);return a.map.setView(o.center,o.zoom)}}}else{t=function(){var t;t=a.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}};return this.hashChangeInterval=setInterval(t,50)}};t.prototype.parseHash=function(t){var o,a,e,n;if(t.indexOf("#")===0){t=t.substr(1)}o=t.split("/");if(o.length===3){n=parseInt(o[0],10);a=parseFloat(o[1]);e=parseFloat(o[2]);if(isNaN(n)||isNaN(a)||isNaN(e)){return false}else{return{center:new L.LatLng(a,e),zoom:n}}}else{return false}};t.prototype.formatHash=function(){var t,o,a;t=this.map.getCenter();a=this.map.getZoom();o=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return[{center:t,zoom:a},"a","#"+[a,t.lat.toFixed(o),t.lng.toFixed(o)].join("/")]};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}return location.hash=""};return t}();L.Map.prototype.addHash=function(){this._hash=new t(this);return this};L.Map.prototype.removeHash=function(){this._hash.remove();return this}}).call(this);