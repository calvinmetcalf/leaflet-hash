(function(){var t,a,o=function(t,a){return function(){return t.apply(a,arguments)}};t=function(){function t(t,a){this.map=t;this.options=a!=null?a:{};this.remove=o(this.remove,this);this.formatHash=o(this.formatHash,this);if(!this.options.path){this.options.path="{z}/{lat}/{lng}"}if(history.pushState){this.withPushState()}else{this.withoutPushState()}}t.prototype.withPushState=function(){var t,a=this;window.onpopstate=function(t){if(t.state){return a.map.setView(t.state.center,t.state.zoom)}};if(location.hash){t=this.parseHash(location.hash);this.map.setView(t.center,t.zoom)}else{history.replaceState.apply(history,this.formatHash())}return this.map.on("moveend",function(){var t;t=a.formatHash();if(location.hash!==t[2]){return history.pushState.apply(history,t)}})};t.prototype.withoutPushState=function(){var t,a,o=this;if(location.hash){a=this.parseHash(location.hash);this.map.setView(a.center,a.zoom)}else{location.hash=this.formatHash()[2]}this.map.on("moveend",function(){var t;t=o.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}});if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){return window.onhashchange=function(){if(location.hash){a=o.parseHash(location.hash);return o.map.setView(a.center,a.zoom)}}}else{t=function(){var t;t=o.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}};return this.hashChangeInterval=setInterval(t,50)}};t.prototype.parseHash=function(t){var a,o,n,e,i,s,h,r;s=this.options.path.split("/");h=s.indexOf("{z}");n=s.indexOf("{lat}");e=s.indexOf("{lng}");if(t.indexOf("#")===0){t=t.substr(1)}a=t.split("/");if(a.length===s.length){r=parseInt(a[h],10);o=parseFloat(a[n]);i=parseFloat(a[e]);if(isNaN(r)||isNaN(o)||isNaN(i)){return false}else{return{center:new L.LatLng(o,i),zoom:r}}}else{return false}};t.prototype.formatHash=function(){var t,a,o;t=this.map.getCenter();o=this.map.getZoom();a=Math.max(0,Math.ceil(Math.log(o)/Math.LN2));return[{center:t,zoom:o},"a","#"+L.Util.template(this.options.path,{lat:t.lat.toFixed(a),lng:t.lng.toFixed(a),z:o})]};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}return location.hash=""};return t}();L.Hash=t;L.hash=function(t,a){if(a==null){a={}}return new L.Hash(t,a)};L.Map.include({addHash:function(a){var o=this;if(a==null){a={}}if(this._loaded){this._hash=new t(this,a)}else{this.on("load",function(){return o._hash=new t(o,a)})}return this}},a=function(){this._hash.remove();return this})}).call(this);