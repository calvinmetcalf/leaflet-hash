(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},a=[].slice;t=function(){function t(t,a){this.map=t;this.options=a!=null?a:{};this.remove=e(this.remove,this);this.getBase=e(this.getBase,this);this.setBase=e(this.setBase,this);this.formatState=e(this.formatState,this);this.updateFromState=e(this.updateFromState,this);this.startListning=e(this.startListning,this);if(!this.options.path){if(this.options.lc){this.options.path="{base}/{z}/{lat}/{lng}"}else{this.options.path="{z}/{lat}/{lng}"}}if(this.options.lc&&!this.options.formatBase){this.options.formatBase=[/[\sA-Z]/g,function(t){if(t.match(/\s/)){return"_ "}if(t.match(/[A-Z]/)){return t.toLowerCase()}}]}if(this.map._loaded){this.startListning()}else{this.map.on("load",this.startListning)}}t.prototype.startListning=function(){var t,e=this;if(location.hash){this.updateFromState(this.parseHash(location.hash))}if(history.pushState){if(!location.hash){history.replaceState.apply(history,this.formatState())}window.onpopstate=function(t){if(t.state){return e.updateFromState(t.state)}};this.map.on("moveend",function(){var t;t=e.formatState();if(location.hash!==t[2]&&!e.moving){return history.pushState.apply(history,t)}})}else{if(!location.hash){location.hash=this.formatState()[2]}t=function(){var t;t=e.formatState();if(location.hash!==t[2]&&!e.moving){return location.hash=t[2]}};this.map.on("moveend",t);if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){window.onhashchange=function(){if(location.hash){return e.updateFromState(e.parseHash(location.hash))}}}else{this.hashChangeInterval=setInterval(t,50)}}if(this.options.lc){return this.map.on("baselayerchange",function(t){var a,s;e.base=(s=e.options.lc._layers[t.layer._leaflet_id].name).replace.apply(s,e.options.formatBase);a=e.formatState();if(history.pushState){if(location.hash!==a[2]&&!e.moving){return history.pushState.apply(history,a)}}else{if(location.hash!==a[2]&&!e.moving){return location.hash=a[2]}}})}};t.prototype.parseHash=function(t){var e,a,s,i,n,o,r,h,l;r=this.options.path.split("/");h=r.indexOf("{z}");s=r.indexOf("{lat}");i=r.indexOf("{lng}");if(t.indexOf("#")===0){t=t.substr(1)}e=t.split("/");if(e.length>2){l=parseInt(e[h],10);a=parseFloat(e[s]);n=parseFloat(e[i]);if(isNaN(l)||isNaN(a)||isNaN(n)){return false}else{o={center:new L.LatLng(a,n),zoom:l};if(e.length>3){o.base=e[r.indexOf("{base}")];return o}else{return o}}}else{return false}};t.prototype.updateFromState=function(t){if(this.moving){return}this.moving=true;this.map.setView(t.center,t.zoom);if(t.base){this.setBase(t.base)}this.moving=false;return true};t.prototype.formatState=function(){var t,e,a,s,i;t=this.map.getCenter();i=this.map.getZoom();e=Math.max(0,Math.ceil(Math.log(i)/Math.LN2));a={center:t,zoom:i};s={lat:t.lat.toFixed(e),lng:t.lng.toFixed(e),z:i};if(this.options.path.indexOf("{base}")>-1){a.base=this.getBase();s.base=a.base}return[a,"a","#"+L.Util.template(this.options.path,s)]};t.prototype.setBase=function(t){var e,a,s,i;this.base=t;a=this.options.lc._form.getElementsByTagName("input");s=a.length;e=0;while(e<s){if(a[e].name==="leaflet-base-layers"&&(i=this.options.lc._layers[a[e].layerId].name).replace.apply(i,this.options.formatBase)===t){a[e].checked=true;this.options.lc._onInputClick();return true}e++}};t.prototype.getBase=function(){var t,e,a,s;if(this.base){return this.base}e=this.options.lc._form.getElementsByTagName("input");a=e.length;t=0;while(t<a){if(e[t].name==="leaflet-base-layers"&&e[t].checked){this.base=(s=this.options.lc._layers[e[t].layerId].name).replace.apply(s,this.options.formatBase);return this.base}}return false};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}location.hash="";return clearInterval(this.hashChangeInterval)};return t}();L.Hash=t;L.hash=function(){var t;t=1<=arguments.length?a.call(arguments,0):[];return function(t,e,a){a.prototype=t.prototype;var s=new a,i=t.apply(s,e);return Object(i)===i?i:s}(L.Hash,t,function(){})};L.Map.include({addHash:function(){var e,s=this;e=1<=arguments.length?a.call(arguments,0):[];if(this._loaded){this._hash=function(t,e,a){a.prototype=t.prototype;var s=new a,i=t.apply(s,e);return Object(i)===i?i:s}(t,[this].concat(a.call(e)),function(){})}else{this.on("load",function(){return s._hash=function(t,e,a){a.prototype=t.prototype;var s=new a,i=t.apply(s,e);return Object(i)===i?i:s}(t,[s].concat(a.call(e)),function(){})})}return this},removeHash:function(){this._hash.remove();return this}})}).call(this);