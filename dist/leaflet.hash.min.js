(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++){if(e in this&&this[e]===t)return e}return-1},n=[].slice;t=function(){function t(t,i){this.map=t;this.options=i!=null?i:{};this.setOverlay=e(this.setOverlay,this);this.setBase=e(this.setBase,this);this.getLayers=e(this.getLayers,this);this.remove=e(this.remove,this);this.formatHash=e(this.formatHash,this);this.updateFromState=e(this.updateFromState,this);this.startListning=e(this.startListning,this);if(!this.options.path){if(this.options.lc){this.options.path="{z}/{lat}/{lng}/{base}"}else{this.options.path="{z}/{lat}/{lng}"}}if(this.map._loaded){this.startListning()}else{this.map.on("load",this.startListning)}}t.prototype.startListning=function(){var t,e=this;if(location.hash){this.updateFromState(this.parseHash(location.hash))}if(history.pushState){if(!location.hash){history.replaceState.apply(history,this.formatHash())}window.onpopstate=function(t){if(t.state){return e.updateFromState(t.state)}};return this.map.on("moveend baselayerchange",function(){var t;t=e.formatHash();if(location.hash!==t[2]){return history.pushState.apply(history,t)}})}else{if(!location.hash){location.hash=this.formatHash()[2]}t=function(){var t;t=e.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}};this.map.on("moveend baselayerchange",t);if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){return window.onhashchange=function(){if(location.hash){return e.updateFromState(e.parseHash(location.hash))}}}else{return this.hashChangeInterval=setInterval(t,50)}}};t.prototype.parseHash=function(t){var e,i,n,s,a,o,r,h,l,p;h=this.options.path.split("/");l=h.indexOf("{z}");s=h.indexOf("{lat}");a=h.indexOf("{lng}");if(this.options.lc){i=h.indexOf("{base}")}if(t.indexOf("#")===0){t=t.substr(1)}e=t.split("/");if(e.length>2){p=parseInt(e[l],10);n=parseFloat(e[s]);o=parseFloat(e[a]);if(isNaN(p)||isNaN(n)||isNaN(o)){return false}else{r={center:new L.LatLng(n,o),zoom:p}}if(e.length>3){r.base=e[i]}return r}else{return false}};t.prototype.updateFromState=function(t){this.map.setView(t.center,t.zoom);if(t.base){return this.setBase(t.base)}};t.prototype.formatHash=function(){var t,e,i,n,s,a;t=this.map.getCenter();a=this.map.getZoom();i=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));n={center:t,zoom:a};s={lat:t.lat.toFixed(i),lng:t.lng.toFixed(i),z:a};if(this.options.lc){e=this.getLayers();n.base=e[0];s.base=e[0]}return[n,"a","#"+L.Util.template(this.options.path,s)]};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}return location.hash=""};t.prototype.getLayers=function(){var t,e;e=["",[]];for(t in this.options.lc._layers){if(this.map._layers[t]){if(this.options.lc._layers[t].overlay){e[1].push(this.options.lc._layers[t].name)}else{e[0]=this.options.lc._layers[t].name}}}return e};t.prototype.setBase=function(t){var e,i,n;e=this.options.lc._baseLayersList;n=e.children.length;i=0;while(i<n){if(e.children[i].children[1].innerHTML.slice(1)===t){e.children[i].children[0].checked=true}i++}return this.options.lc._onInputClick()};t.prototype.setOverlay=function(t){var e,n,s,a,o;if(t==="-"){return}a=t.split(",");s=this.options.lc._container.children[1].children[2].children;n=s.length;e=0;while(e<n){if(o=s[e].children[1].innerHTML.slice(1),i.call(a,o)>=0){s[e].children[0].checked=true}else{s[e].children[0].checked=false}e++}return this.options.lc._onInputClick()};return t}();L.Hash=t;L.hash=function(){var t;t=1<=arguments.length?n.call(arguments,0):[];return function(t,e,i){i.prototype=t.prototype;var n=new i,s=t.apply(n,e);return Object(s)===s?s:n}(L.Hash,t,function(){})};L.Map.include({addHash:function(){var e,i=this;e=1<=arguments.length?n.call(arguments,0):[];if(this._loaded){this._hash=function(t,e,i){i.prototype=t.prototype;var n=new i,s=t.apply(n,e);return Object(s)===s?s:n}(t,[this].concat(n.call(e)),function(){})}else{this.on("load",function(){return i._hash=function(t,e,i){i.prototype=t.prototype;var n=new i,s=t.apply(n,e);return Object(s)===s?s:n}(t,[i].concat(n.call(e)),function(){})})}return this},removeHash:function(){this._hash.remove();return this}})}).call(this);