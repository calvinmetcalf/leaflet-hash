(function(){var t,a=function(t,a){return function(){return t.apply(a,arguments)}},n=[].slice;t=function(){function t(t,n){this.map=t;this.options=n!=null?n:{};this.remove=a(this.remove,this);this.formatHash=a(this.formatHash,this);this.updateFromState=a(this.updateFromState,this);this.startListning=a(this.startListning,this);if(!this.options.path){this.options.path="{z}/{lat}/{lng}"}if(this.map._loaded){this.startListning()}else{this.map.on("load",this.startListning)}}t.prototype.startListning=function(){var t,a=this;if(location.hash){this.updateFromState(this.parseHash(location.hash))}if(history.pushState){if(!location.hash){history.replaceState.apply(history,this.formatHash())}window.onpopstate=function(t){if(t.state){return a.updateFromState(t.state)}};return this.map.on("moveend",function(){var t;t=a.formatHash();if(location.hash!==t[2]){return history.pushState.apply(history,t)}})}else{if(!location.hash){location.hash=this.formatHash()[2]}t=function(){var t;t=a.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}};this.map.on("moveend",t);if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){return window.onhashchange=function(){if(location.hash){return a.updateFromState(a.parseHash(location.hash))}}}else{return this.hashChangeInterval=setInterval(t,50)}}};t.prototype.parseHash=function(t){var a,n,o,e,i,s,h,r,p;h=this.options.path.split("/");r=h.indexOf("{z}");o=h.indexOf("{lat}");e=h.indexOf("{lng}");if(t.indexOf("#")===0){t=t.substr(1)}a=t.split("/");if(a.length>2){p=parseInt(a[r],10);n=parseFloat(a[o]);i=parseFloat(a[e]);if(isNaN(p)||isNaN(n)||isNaN(i)){return false}else{return s={center:new L.LatLng(n,i),zoom:p}}}else{return false}};t.prototype.updateFromState=function(t){return this.map.setView(t.center,t.zoom)};t.prototype.formatHash=function(){var t,a,n,o,e;t=this.map.getCenter();e=this.map.getZoom();a=Math.max(0,Math.ceil(Math.log(e)/Math.LN2));n={center:t,zoom:e};o={lat:t.lat.toFixed(a),lng:t.lng.toFixed(a),z:e};return[n,"a","#"+L.Util.template(this.options.path,o)]};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}location.hash="";return clearInterval(this.hashChangeInterval)};return t}();L.Hash=t;L.hash=function(){var t;t=1<=arguments.length?n.call(arguments,0):[];return function(t,a,n){n.prototype=t.prototype;var o=new n,e=t.apply(o,a);return Object(e)===e?e:o}(L.Hash,t,function(){})};L.Map.include({addHash:function(){var a,o=this;a=1<=arguments.length?n.call(arguments,0):[];if(this._loaded){this._hash=function(t,a,n){n.prototype=t.prototype;var o=new n,e=t.apply(o,a);return Object(e)===e?e:o}(t,[this].concat(n.call(a)),function(){})}else{this.on("load",function(){return o._hash=function(t,a,n){n.prototype=t.prototype;var o=new n,e=t.apply(o,a);return Object(e)===e?e:o}(t,[o].concat(n.call(a)),function(){})})}return this},removeHash:function(){this._hash.remove();return this}})}).call(this);